package github.com/hashicorp/terraform-provider-azurerm/internal/tools/document-fmt/markdown
import (
	"bufio"
	"fmt"
	"strings"

	"github.com/spf13/afero"
)
func (d *Document) Parse(fs afero.Fs) error {
	var current Section
	var content []string

	file, err := fs.Open(d.Path)
	if err != nil {
		return fmt.Errorf("opening file `%s`: %+v", d.Path, err)
	}

	scanner := bufio.NewScanner(file)
	for scanner.Scan() {
		t := scanner.Text()

		// if length of `d.Content` is 0 and line has `---` prefix, we're parsing FrontMatter
		if strings.HasPrefix(t, "#") || (len(content) == 0 && strings.HasPrefix(t, "---")) {
			if current != nil {
				current.SetContent(content)
				d.Sections = append(d.Sections, current)

				current = nil
				content = nil
			}

			for _, s := range RegisteredSections() {
				if s.Match(t) {
					current = s
				}
			}

			// if we didn't match any, default to unknown section
			if current == nil {
				current = &SectionUnknown{}
			}

			current.SetHeading(t)
		}

		content = append(content, t)
	}

	// handle final section
	if current != nil {
		content = append(content, "")
		current.SetContent(content)
		d.Sections = append(d.Sections, current)
	}

	return nil
}
