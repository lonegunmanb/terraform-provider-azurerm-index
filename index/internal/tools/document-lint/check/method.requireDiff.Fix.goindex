package github.com/hashicorp/terraform-provider-azurerm/internal/tools/document-lint/check
import (
	"fmt"
	"strings"

	"github.com/hashicorp/terraform-provider-azurerm/internal/tools/document-lint/util"
)
func (c requireDiff) Fix(line string) (result string, err error) {
	from, to := "(Required)", "(Optional)"

	switch c.RequiredMiss {
	case ShouldBeComputed:
		// remove from both. may cause two space, have to remove one
		var idx, size int
		if idx = strings.Index(line, from); idx > 0 {
			size = len(from)
		} else if idx = strings.Index(line, to); idx > 0 {
			size = len(to)
		}
		if idx > 0 {
			if line[idx-1] == ' ' && line[idx+size] == ' ' {
				idx -= 1
				size += 1
			}
			line = line[:idx] + line[idx+size:]
		}
	case ShouldBeOptional, ShouldBeRequired:
		if c.RequiredMiss == ShouldBeRequired {
			from, to = to, from
		}
		if strings.Contains(line, from) {
			line = strings.Replace(line, from, to, 1)
		} else {
			// add after the first -
			if idx := strings.Index(line, " - "); idx > 0 {
				line = line[:idx+3] + to + " " + line[idx+3:]
			} else {
				// no dash add after second `
				idx = strings.Index(line, "`")
				idx += strings.Index(line[idx+1:], "`") + 1
				line = line[:idx+1] + " " + to + line[idx+1:]
			}
		}
	}
	return line, nil
}
