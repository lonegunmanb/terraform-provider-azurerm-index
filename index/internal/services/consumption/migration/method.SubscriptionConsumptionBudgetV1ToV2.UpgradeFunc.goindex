package github.com/hashicorp/terraform-provider-azurerm/internal/services/consumption/migration
import (
	"context"
	"fmt"

	"github.com/hashicorp/go-azure-helpers/resourcemanager/commonids"
	"github.com/hashicorp/go-azure-sdk/resource-manager/consumption/2019-10-01/budgets"
	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/pluginsdk"
)
func (SubscriptionConsumptionBudgetV1ToV2) UpgradeFunc() pluginsdk.StateUpgraderFunc {
	return func(ctx context.Context, rawState map[string]interface{}, meta interface{}) (map[string]interface{}, error) {
		// since the `subscription_id` field gets incorrectly mutated in the V0 -> V1 upgrade
		// we have to parse it from the ID instead to correct this
		idRaw := rawState["id"].(string)
		id, err := budgets.ParseScopedBudgetID(idRaw)
		if err != nil {
			return nil, fmt.Errorf("parsing %q: %+v", idRaw, err)
		}

		newSubscriptionId := commonids.NewSubscriptionID(id.Scope).ID()
		rawState["subscription_id"] = newSubscriptionId

		return rawState, nil
	}
}
