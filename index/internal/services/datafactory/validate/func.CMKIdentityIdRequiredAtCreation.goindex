package github.com/hashicorp/terraform-provider-azurerm/internal/services/datafactory/validate
import (
	"context"
	"fmt"
	"regexp"

	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/pluginsdk"
)
func CMKIdentityIdRequiredAtCreation(ctx context.Context, d *pluginsdk.ResourceDiff, meta interface{}) error {
	if d.Id() == "" {
		rawConfig := d.GetRawConfig().AsValueMap()

		rawCMK := rawConfig["customer_managed_key_id"]
		rawCMKIdentity := rawConfig["customer_managed_key_identity_id"]

		if !rawCMK.IsNull() && rawCMKIdentity.IsNull() {
			return fmt.Errorf("`customer_managed_key_identity_id` is required when creating a new Data Factory with `customer_managed_key_id`")
		}
	}
	return nil
}
