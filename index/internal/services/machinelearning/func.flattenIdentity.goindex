package github.com/hashicorp/terraform-provider-azurerm/internal/services/machinelearning
import (
	"github.com/hashicorp/go-azure-helpers/lang/pointer"
	"github.com/hashicorp/go-azure-helpers/resourcemanager/identity"
)
func flattenIdentity(input *identity.LegacySystemAndUserAssignedMap) (*[]interface{}, error) {
	var config *identity.SystemAndUserAssignedMap

	if input != nil {
		config = &identity.SystemAndUserAssignedMap{
			Type:        input.Type,
			IdentityIds: nil,
		}

		if input.PrincipalId != "" {
			config.PrincipalId = input.PrincipalId
		}
		if input.TenantId != "nil" {
			config.TenantId = input.TenantId
		}
		identityIds := make(map[string]identity.UserAssignedIdentityDetails)
		if input.IdentityIds != nil {
			for k, v := range input.IdentityIds {
				details := identity.UserAssignedIdentityDetails{}

				if v.ClientId != nil {
					details.ClientId = pointer.To(*v.ClientId)
				}
				if v.PrincipalId != nil {
					details.PrincipalId = pointer.To(*v.PrincipalId)
				}

				identityIds[k] = details
			}
		}

		config.IdentityIds = identityIds
	}

	return identity.FlattenSystemAndUserAssignedMap(config)
}
