package github.com/hashicorp/terraform-provider-azurerm/internal/services/compute
import (
	"slices"

	"github.com/hashicorp/go-azure-helpers/lang/pointer"
	"github.com/hashicorp/go-azure-helpers/resourcemanager/commonids"
	"github.com/hashicorp/go-azure-helpers/resourcemanager/commonschema"
	"github.com/hashicorp/go-azure-sdk/resource-manager/compute/2024-03-01/virtualmachines"
	"github.com/hashicorp/go-azure-sdk/resource-manager/compute/2024-07-01/virtualmachinescalesets"
	"github.com/hashicorp/terraform-provider-azurerm/internal/services/compute/validate"
	keyVaultValidate "github.com/hashicorp/terraform-provider-azurerm/internal/services/keyvault/validate"
	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/pluginsdk"
	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/validation"
)
func expandBootDiagnostics(input []interface{}) *virtualmachines.DiagnosticsProfile {
	if len(input) == 0 {
		return &virtualmachines.DiagnosticsProfile{
			BootDiagnostics: &virtualmachines.BootDiagnostics{
				Enabled:    pointer.To(false),
				StorageUri: pointer.To(""),
			},
		}
	}

	// this serves the managed boot diagnostics, in this case we only have this empty block without `storage_account_uri` set
	if input[0] == nil {
		return &virtualmachines.DiagnosticsProfile{
			BootDiagnostics: &virtualmachines.BootDiagnostics{
				Enabled:    pointer.To(true),
				StorageUri: pointer.To(""),
			},
		}
	}

	raw := input[0].(map[string]interface{})

	storageAccountUri := raw["storage_account_uri"].(string)

	return &virtualmachines.DiagnosticsProfile{
		BootDiagnostics: &virtualmachines.BootDiagnostics{
			Enabled:    pointer.To(true),
			StorageUri: pointer.To(storageAccountUri),
		},
	}
}
