package github.com/hashicorp/terraform-provider-azurerm/internal/services/web
import (
	"fmt"
	"log"
	"math"
	"strings"

	"github.com/Azure/azure-sdk-for-go/services/web/mgmt/2021-02-01/web" // nolint: staticcheck
	"github.com/hashicorp/go-azure-helpers/resourcemanager/identity"
	"github.com/hashicorp/terraform-provider-azurerm/internal/features"
	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/pluginsdk"
	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/validation"
	"github.com/hashicorp/terraform-provider-azurerm/utils"
)
func schemaAppServiceLogsConfig() *pluginsdk.Schema {
	return &pluginsdk.Schema{
		Type:     pluginsdk.TypeList,
		Optional: true,
		Computed: true,
		MaxItems: 1,
		Elem: &pluginsdk.Resource{
			Schema: map[string]*pluginsdk.Schema{
				"application_logs": {
					Type:     pluginsdk.TypeList,
					Optional: true,
					Computed: true,
					MaxItems: 1,
					Elem: &pluginsdk.Resource{
						Schema: map[string]*pluginsdk.Schema{
							"file_system_level": {
								Type:     pluginsdk.TypeString,
								Optional: true,
								Default:  "Off",
								ValidateFunc: validation.StringInSlice([]string{
									string(web.LogLevelError),
									string(web.LogLevelInformation),
									string(web.LogLevelOff),
									string(web.LogLevelVerbose),
									string(web.LogLevelWarning),
								}, false),
							},
							"azure_blob_storage": {
								Type:     pluginsdk.TypeList,
								Optional: true,
								MaxItems: 1,
								Elem: &pluginsdk.Resource{
									Schema: map[string]*pluginsdk.Schema{
										"level": {
											Type:     pluginsdk.TypeString,
											Required: true,
											ValidateFunc: validation.StringInSlice([]string{
												string(web.LogLevelError),
												string(web.LogLevelInformation),
												string(web.LogLevelOff),
												string(web.LogLevelVerbose),
												string(web.LogLevelWarning),
											}, false),
										},
										"sas_url": {
											Type:      pluginsdk.TypeString,
											Required:  true,
											Sensitive: true,
										},
										"retention_in_days": {
											Type:     pluginsdk.TypeInt,
											Required: true,
										},
									},
								},
							},
						},
					},
				},
				"http_logs": {
					Type:     pluginsdk.TypeList,
					Optional: true,
					Computed: true,
					MaxItems: 1,
					Elem: &pluginsdk.Resource{
						Schema: map[string]*pluginsdk.Schema{
							"file_system": {
								Type:     pluginsdk.TypeList,
								Optional: true,
								MaxItems: 1,
								Elem: &pluginsdk.Resource{
									Schema: map[string]*pluginsdk.Schema{
										"retention_in_mb": {
											Type:         pluginsdk.TypeInt,
											Required:     true,
											ValidateFunc: validation.IntBetween(25, 100),
										},
										"retention_in_days": {
											Type:         pluginsdk.TypeInt,
											Required:     true,
											ValidateFunc: validation.IntAtLeast(0),
										},
									},
								},
								ConflictsWith: []string{"logs.0.http_logs.0.azure_blob_storage"},
								AtLeastOneOf:  []string{"logs.0.http_logs.0.azure_blob_storage", "logs.0.http_logs.0.file_system"},
							},
							"azure_blob_storage": {
								Type:     pluginsdk.TypeList,
								Optional: true,
								MaxItems: 1,
								Elem: &pluginsdk.Resource{
									Schema: map[string]*pluginsdk.Schema{
										"sas_url": {
											Type:      pluginsdk.TypeString,
											Required:  true,
											Sensitive: true,
										},
										"retention_in_days": {
											Type:     pluginsdk.TypeInt,
											Required: true,
										},
									},
								},
								ConflictsWith: []string{"logs.0.http_logs.0.file_system"},
								AtLeastOneOf:  []string{"logs.0.http_logs.0.azure_blob_storage", "logs.0.http_logs.0.file_system"},
							},
						},
					},
				},
				"detailed_error_messages_enabled": {
					Type:     pluginsdk.TypeBool,
					Optional: true,
					Default:  false,
				},
				"failed_request_tracing_enabled": {
					Type:     pluginsdk.TypeBool,
					Optional: true,
					Default:  false,
				},
			},
		},
	}
}
