package github.com/hashicorp/terraform-provider-azurerm/internal/services/cdn/validate
import (
	"errors"
	"regexp"
	"strings"

	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/pluginsdk"
	"github.com/hashicorp/terraform-provider-azurerm/internal/tf/validation"
)
func RuleActionUrlRedirectQueryString() pluginsdk.SchemaValidateFunc {
	return func(i interface{}, s string) ([]string, []error) {
		querystring := i.(string)

		re := regexp.MustCompile("^[?&]")
		if re.MatchString(querystring) {
			return nil, []error{errors.New("the Url Query String must not start with a question mark or ampersand")}
		}

		kvre := regexp.MustCompile("^[^?&]+=[^?&]+$")
		kvs := strings.Split(querystring, "&")
		for _, kv := range kvs {
			if len(kv) > 0 && !kvre.MatchString(kv) {
				return nil, []error{errors.New("the Url Query String must be in <key>=<value> format and separated by an ampersand")}
			}
		}

		return nil, nil
	}
}
